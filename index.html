<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Accessibility Mapper</title>
    <meta charset="utf-8">

    <!-- Support for browsers on mobile phones. -->
    <meta name="viewport"
          content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Google Web Fonts. -->
    <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed'
          rel='stylesheet' type='text/css'>

        <!-- Custom CSS styles for our application. -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">


    <link rel="stylesheet" href="/static/style.css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

     <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
      <script src='/_ah/channel/jsapi'></script>

    <!-- The Google JavaScript loader tool (for the Maps, Charts APIs). -->
    <script src="https://www.google.com/jsapi"></script>


    <!-- Accessibility Tool javascript. -->
    <script src="/static/access-tool-client-main.js"></script>


  </head>
  <body>


  <!-- The DOM of our application. -->
  <div class="access-app">
      <!-- The title of the application. -->
      <h1>Global Accessibility Mapping</h1>

      <!-- A container which the Maps API will populate with a map. -->
      <div class="map"></div>

      {# The UI wrapper for the control box and notifications. #}
      <div class="ui">
          <!-- The main tool panel  -->
          <div class="panel">
            <header>
                <h2>Interactive Accessibility Tool</h2>
                <p class="instructions">
                    Choose the points to which you want to map the travel time.
                </p>
            </header>

            <!-- The button to toggle the panel expanded/collapsed. Mobile-only. -->
            <span class="toggler glyphicon glyphicon-menu-hamburger"></span>

            <div class="tool-controls">
                <div class="inputs">
                    <div class="input-block markercontrols">
                        <p class="instructions">
                            Click the map to add markers.
                        </p>
                        <div class="input-block loadcontrols well hidden-xs">
                            <p class="instructions">
                                Alternatively you can load points from a CSV file. Click to choose a file:
                            </p>
                            <button class="loadcsv btn btn-default btn-xs btn-file">
                                Load CSV<input type="file" class="loadcsv btn-file">
                            </button>
                        </div>
                    </div>

                    <div class="input-block maincontrols well">
                        <p class="instructions">
                            When you have added all the points, click to create the map
                        </p>
                        <button class="run btn btn-primary btn-xs" disabled>Run Tool</button>
                    </div>

                    <div class="input-block exportcontrols well hidden" >
                        <p class="instructions">
                            You can export the map to your Google Drive.
                            You can only export a limited area, so zoom in the map until the Export button becomes enabled.
                            You don't need to wait for the images to finish loading on-screen!
                        </p>
                        <button class="export btn btn-primary btn-xs" data-toggle="modal" data-target="#exportModal" disabled>Export</button>
                    </div>

                    <button class="clear btn btn-danger btn-xs" disabled>Clear Map</button>

                    <button class="showinfo btn btn-info btn-xs pull-right">?</button>
            </div>

        </div>
              </div>
          <div class="alerts"></div>

    </div>

  <!--login modal-->
    <div id="infoModal" class="modal fade"  role="dialog">
      <div class="modal-dialog modal-lg">
      <div class="modal-content">
          <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">Ã—</button>
              <h2 class="text-center">Interactive Accessibility Tool</h2>
          </div>
          <div class="modal-body">
              <p>This tool allows to create your own custom accessibility map, showing the estimated travel time
              from all locations to the nearest point of interest.</p>
              <p>Using the locations of all cities with 50,000 or more inhabitants resulted in the global map of accessibility
                  <a href="http://dev.roadlessforest.eu/map.html">
                  published recently.&nbsp
                  </a>However, this tool uses the same underlying datasets to create new accessibility maps to a location or
              locations of your choice, while you wait.</p>
              <p>To enter the locations, you can either click on the map to add points, or you can load a CSV file. If you choose
              to load a CSV then you must pick a file containing columns called "lat" and "lon", or "x" and "y".</p>
              <p>Once the points are added to the map, click Run Tool to calculate the map. Depending on the area, this will take from
              several seconds to several minutes to complete.</p>
              <p>You can export the generated map to your Google Drive account, so you can obtain a local copy for use in a GIS program
              of your choice. To enable the "export" button you will need to zoom in the map, as the export can only be run for a limited
              area - pan the map to display the area of interest for export before pressing the button. Please note that due to the
              on-demand processing nature of Google Earth Engine, the export may take as long as several hours to complete!</p>
              <form>
                  <div class="checkbox">
                      <label><input type="checkbox" value="" id="chkNoShowSplash">Don't show this next time!</label>
                  </div>
              </form>
                <div class="form-group">
                  <button class="btn btn-primary btn-lg btn-block" data-dismiss="modal">Get Started!</button>
                </div>
          </div>
          <div class="modal-footer">

          </div>
      </div>
      </div>
    </div>
  <div id="exportModal" class="modal fade" role="dialog">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">x</button>
                  <h2 class="text-center">Export result map</h2>
              </div>
              <div class="modal-body">
                  <p>You can export the map as it is currently shown on screen to a file in your Google Drive.</p>
                  <p>The map export will be limited to the area currently shown on the map, so pan the
                  map to the area you're interested in before beginning the export. You can only export a limited
                  area, so if you zoom out too far then the export button will be disabled.</p>
                  <p>The export will take a while to run - anything up to several hours!</p>

              <div class="input-block">
                        <span class="input-block-label">Filename:</span>
                        <input type="text" name="filename" class="filename form-control" placeholder="default: Access_Map_Export_<datetime>">
                    </div>
                </div>
                <button class="exportFire btn btn-primary" disabled>Export</button>
              </div>
          </div>

      </div>
  </div>

  <a href="https://earthengine.google.org">
      <img class="powered-by-ee"
           alt="Powered by Google Earth Engine"
           src="/static/google_earthengine_powered_400px.png">
  </a>

  <a href="http://www.map.ox.ac.uk" target="_blank">
    <img id="maplogo" style="position: absolute; top: 0; right: 0; border: 0; z-index: 1;"
         class="hidden-xs"
         alt="Malaria Atlas Project"
         src="static/map_logo_square_alt.png"
         >
  </a>
    <div class="templates">
        <div class="alert alert-dismissible" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    </div>

  <!-- Boot our JavaScript once the body has loaded. -->
  <script>
    access_tool.boot(
        '{{ eeMapId | safe }}'
        ,'{{ eeToken | safe }}'
        ,'{{ channelToken }}'
        ,'{{ channelClientId }}'
        //,'{{ serializedPolygonIds | safe }}'
      );
  </script>

</body>
</html>
